{% extends 'layout/master.njk' %}

{% block content %}
<div class="container admin-dashboard-margin-y-8">
  <div class="admin-article-form-container dp-pt-0">
    <div class="row align-items-center admin-dashboard-fix-row">
      <div class="col-sm-12 col-md-12">
        <div class="card admin-dashboard-card dp-pt-0" itemscope itemtype="https://schema.org/Table">
            {# Inset text - conditional based on post status #}
            {% if isDraft %}
                <div class="dp-inset-text dp-inset-text--yellow">
                    <p>
                        You’re editing a <strong class="key-term">draft</strong>.
                        It’s not visible on the
                        <strong class="key-term">live site</strong> yet —
                        <strong class="key-term">publish</strong> it when you’re ready to make it live.
                    </p>
                </div>
            {% else %}
                <div class="dp-inset-text dp-inset-text--success">
                    <p>
                        You're viewing a <strong class="key-term">published post</strong>.
                        Any changes must be made in a
                        <strong class="key-term">revision draft</strong>.
                        Create a <strong class="key-term">revision draft</strong> to update the
                        <strong class="key-term">live version</strong>.
                    </p>
                </div>
            {% endif %}

            {# Success Message #}
            {% if success_flash_messages.length > 0 %}
                {% set msg = success_flash_messages[0] %}
                {{ flashPanel('completion', msg.title, msg.message) | safe }}
            {% endif %}

            {# Information Message #}
            {% if info_flash_messages.length > 0 %}
                {% set msg = info_flash_messages [0] %}
                {{ flashPanel('information', msg.title, msg.message) | safe }}
            {% endif %}

            {# Warning Message #}
            {% if warning_flash_messages.length > 0 %}
                {% set msg = warning_flash_messages[0] %}
                {{ flashPanel('warning', msg.title, msg.message) | safe }}
            {% endif %}

            {# Error messages #}
            {% if error_flash_messages.length > 0 %}
            <div class="dp-error-summary">
                <h2 class="dp-error-summary__title">There is a problem</h2>
                <div class="dp-error-summary__body">
                    <ul class="dp-error-summary__list">
                        {% for message in error_flash_messages %}
                        <li>{{ message }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endif %}
          
            {{ form().openTag(f) }}

                {{ formHidden(f.get('id')) | safe }}
                {{ formHidden(f.get('author_id')) | safe }}

                <div class="form-group{% if errorDecorator(f.get('title')) %} dp-form-group--error{% endif %}">
                    {{ formLabel(f.get('title')) | safe }}
                    {{ formError(f.get('title')) | safe }}
                    {{ formText(f.get('title')) | safe }}
                </div>

                <div class="form-group{% if errorDecorator(f.get('slug')) %} dp-form-group--error{% endif %}">
                    {{ formLabel(f.get('slug')) | safe }}
                    {{ formError(f.get('slug')) | safe }}
                    {{ formText(f.get('slug')) | safe }}
                </div>

                <div class="form-group{% if errorDecorator(f.get('excerpt_markdown')) %} dp-form-group--error{% endif %}">
                    {{ formLabel(f.get('excerpt_markdown')) | safe }}
                    {{ detail(f.get('excerpt_markdown'), "Ideal length: 130–150 characters. Shown in Google and social previews.") | safe }}
                    {{ formError(f.get('excerpt_markdown')) | safe }}
                    {{ formTextarea(f.get('excerpt_markdown')) | safe }}
                </div>

                <div class="form-group{% if errorDecorator(f.get('content_markdown')) %} dp-form-group--error{% endif %}">
                    {{ formLabel(f.get('content_markdown')) | safe }}
                    {{ formError(f.get('content_markdown')) | safe }}
                    {{ formTextarea(f.get('content_markdown')) | safe }}
                </div>

                <div class="form-group{% if errorDecorator(f.get('author_name')) %} dp-form-group--error{% endif %}">
                    {{ formLabel(f.get('author_name')) | safe }}
                    {{ formError(f.get('author_name')) | safe }}
                    {{ formText(f.get('author_name')) | safe }}
                </div>

                <div class="form-group{% if errorDecorator(f.get('category_id')) %} dp-form-group--error{% endif %}">
                    {{ formLabel(f.get('category_id')) | safe }}
                    {{ formError(f.get('category_id')) | safe }}
                    {{ formSelect(f.get('category_id')) | safe }}
                </div>

                <div class="form-group{% if errorDecorator(f.get('meta_description')) %} dp-form-group--error{% endif %}">
                    {{ formLabel(f.get('meta_description')) | safe }}
                    {{ detail(f.get('meta_description'), "If left empty, we'll use the Excerpt. Ideal length: 130–150 characters. Shown in Google and social previews.") | safe }}
                    {{ formError(f.get('meta_description')) | safe }}
                    {{ formTextarea(f.get('meta_description')) | safe }}
                </div>

                <div class="form-group{% if errorDecorator(f.get('comments_enabled')) %} dp-form-group--error{% endif %}">
                    {{ formCheckbox(f.get('comments_enabled')) | safe }}
                    {{ formLabel(f.get('comments_enabled')) | safe }}
                    {{ formError(f.get('comments_enabled')) | safe }}
                </div>

                <div class="form-group">
                    <div class="dp-button-group">
                        <div class="dp-button-group__left">
                            {% if isDraft %}
                                {# Draft post: Show Save, Publish, Delete, Exit buttons #}
                                <div class="dp-button-group__primary-actions">
                                    {% if f.get('save') %}
                                        {{ formSubmit(f.get('save')) | safe }}
                                    {% endif %}
                                    {% if f.get('publish') %}
                                        {{ formSubmit(f.get('publish')) | safe }}
                                    {% endif %}
                                </div>
                                {% if f.get('delete') %}
                                    <div class="dp-button-group__destructive-actions">
                                        {{ formSubmit(f.get('delete')) | safe }}
                                    </div>
                                {% endif %}
                                <div class="dp-button-group__secondary-actions">
                                    {{ formSubmit(f.get('exit_this_page')) | safe }}
                                </div>
                            {% else %}
                                {# Published post: Show revision and unpublish buttons #}
                                <div class="dp-button-group__primary-actions">
                                    {% if f.get('create_revision_draft') %}
                                        {{ formSubmit(f.get('create_revision_draft')) | safe }}
                                    {% endif %}
                                    {% if f.get('continue_revision_draft') %}
                                        {{ formSubmit(f.get('continue_revision_draft')) | safe }}
                                    {% endif %}
                                </div>
                                {% if f.get('unpublish') %}
                                    <div class="dp-button-group__destructive-actions">
                                        {{ formSubmit(f.get('unpublish')) | safe }}
                                    </div>
                                {% endif %}
                                <div class="dp-button-group__secondary-actions">
                                    {{ formSubmit(f.get('exit_this_page')) | safe }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {{ form().closeTag() }}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}